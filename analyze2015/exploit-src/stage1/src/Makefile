TRUNK?=.
mtd-src=$(TRUNK)/openwrt-mtd

mtd:
	make -C $(mtd-src) $@
	cp $(mtd-src)/mtd $(TRUNK)/



.rootfs.stamp:rootfs.tar.gz
	tar zxf $<
	touch $@

.wpsd.stamp: wpsd .rootfs.stamp
	install -m 0755 $(TRUNK)/wpsd \
	 $(TRUNK)/rootfs/usr/sbin/wpsd
	
	touch $@

install:mtd .wpsd.stamp
	install -m 0755 $(TRUNK)/mtd $(TRUNK)/rootfs/usr/sbin/mtd

clean:
	-rm mtd
	make -C $(mtd-src) $@
	rm -rf $(TRUNK)/rootfs
	rm -rf .*stamp
